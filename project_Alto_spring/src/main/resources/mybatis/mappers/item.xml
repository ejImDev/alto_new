<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.item">
	<resultMap type="itemDTO" id="itemResult">		
		<result property="item_code" column="item_code" />		
		<result property="hobby_code" column="hobby_code" />
		<result property="hobby_sub_code" column="hobby_sub_code" />
		<result property="item_name" column="item_name" />
		<result property="item_count" column="item_count" />
		<result property="quantity" column="quantity" />
		<result property="price" column="price" />
		<result property="imgName" column="imgName" />
		<result property="intro" column="intro" />
		<result property="regidate" column="regidate" />
	</resultMap>
	
	<resultMap id="ItemImgResult" type="itemImageDTO">
	  <result property="imageFileNO" column="imageFileNO" />
	  <result property="item_code" column="item_code" />
	  <result property="imageFileName" column="imageFileName" />
 	</resultMap>
	
	<!-- 전체 조회 -->
	<select id="selectAllitemList" resultMap="itemResult">
		<![CDATA[
			SELECT *
			FROM ALTO_ITEM
		]]> 
	</select>

	<!-- 새글 쓰기 -->
	<!-- 로그인 기능 구현전이라 아이디값 수기 기재해둠. 나중에 꼭 수정필요(7/26) -->
	<insert id="insertNewItem"  parameterType="java.util.Map">
		<![CDATA[
			INSERT INTO EZEN.ALTO_ITEM
			(ITEM_CODE, HOBBY_CODE, HOBBY_SUB_CODE, ITEM_NAME, PRICE, REGIDATE, IMGNAME, INTRO, ITEM_COUNT, QUANTITY)
			VALUES(#{item_code}, #{cate_m}, #{cate_s}, #{item_name}, #{price}, sysdate , null, #{intro}, 0 , #{quantity})
		]]>      
	</insert>

	<!-- 새글 이미지 -->
	<insert id="insertNewImage"  parameterType="java.util.Map">
    	<foreach item="item"  collection="list" open="INSERT ALL" separator=" " close="SELECT * FROM DUAL" >
      		INTO alto_item_image(imageFileNO, imageFileName, item_code)
     		VALUES (#{item.imageFileNO}, #{item.imageFileName}, #{item.item_code})
    	</foreach>
 	</insert>
  
  	<select id="selectNewitem_codeN" resultType="int">
		<![CDATA[ 
			SELECT nvl(max(item_code),0)+1
			FROM ALTO_ITEM
		]]>
	</select>
  
	<select id="selectNewitem_code" parameterType="int" resultType="String">
		<![CDATA[ 
			SELECT LPAD(#{item_codeN}, 6, 0) FROM DUAL
		]]>
	</select>
	
	<select id="selectNewImageFileNO" resultType="int">
    	<![CDATA[
      		SELECT nvl(max(imageFileNO),0) from alto_item_image		
    	]]>
	</select>
	
	<select id="selectItem" resultType="itemDTO" parameterType="int">
		<![CDATA[ 
			SELECT *
			FROM alto_item
			WHERE imageFileNO = #{imageFileNO}
		]]>
	</select>
	
	<select id="selectImageFileList" resultMap="ItemImgResult" parameterType="int">
		<![CDATA[ 
			SELECT *
			FROM alto_item_image
			WHERE imageFileNO = #{imageFileNO}
		]]>
	</select>

</mapper>

